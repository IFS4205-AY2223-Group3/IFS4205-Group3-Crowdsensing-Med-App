{"ast":null,"code":"var _jsxFileName = \"/Users/oscarlai/Desktop/NUS/Year 4/Semester 1/IFS4205/IFS4205-Group3-Crowdsensing-Med-App/frontend/src/context/AuthProvider.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\n// import * as React from \"react\";\nimport { Navigate, useLocation } from \"react-router-dom\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { LOGIN_URL } from \"../api/constants\";\nimport { React, useState, useEffect } from \"react\"; // const authContext = React.createContext();\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Context = React.createContext();\n\nfunction useAuth() {\n  const setData = _ref => {\n    let {\n      accessToken,\n      role,\n      name,\n      userId\n    } = _ref;\n    localStorage.setItem(\"accessToken\", accessToken);\n    localStorage.setItem(\"userRole\", role);\n    localStorage.setItem(\"name\", name);\n    localStorage.setItem(\"userId\", userId);\n  };\n\n  const login = async _ref2 => {\n    let {\n      user,\n      pwd,\n      userRole\n    } = _ref2;\n\n    try {\n      const response = await axios.post(LOGIN_URL, JSON.stringify({\n        user,\n        pwd,\n        userRole\n      }), {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        withCredentials: true\n      });\n      const accessToken = \"response?.data?.accessToken\";\n      const role = \"patient\";\n      const name = \"John\";\n      const userId = \"response?.data.userId\";\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId\n      };\n      setData(auth);\n    } catch (error) {\n      const accessToken = \"response?.data?.accessToken\";\n      const role = \"patient\";\n      const name = \"John\";\n      const userId = \"response?.data.userId\";\n      console.log(\"here\");\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId\n      };\n      setData(auth);\n      console.log(error);\n    }\n  }; // const checkRole = ({accessToken,userRole}) => {\n  //   if ()\n  // }\n  // const [authed, setAuthed] = React.useState({});\n\n\n  return {\n    // authed,\n    login // login() {\n    //   return new Promise((res) => {\n    //     setAuthed(true);\n    //     res();\n    //   });\n    // },\n    // logout() {\n    //   return new Promise((res) => {\n    //     setAuthed(false);\n    //     res();\n    //   });\n    // },\n\n  };\n}\n\nexport function AuthProvider(_ref3) {\n  _s();\n\n  let {\n    children\n  } = _ref3;\n  const [auth, setAuth] = useState({});\n  useEffect(() => {\n    const accessToken = JSON.parse(localStorage.getItem(\"accessToken\"));\n    const userRole = JSON.parse(localStorage.getItem(\"userRole\"));\n    const name = JSON.parse(localStorage.getItem(\"name\"));\n    const userId = JSON.parse(localStorage.getItem(\"userId\"));\n\n    if (accessToken && userRole && name && userId) {\n      const temp = {\n        accessToken: accessToken,\n        userRole: userRole,\n        name: name,\n        userId: userId\n      };\n      setAuth(temp);\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(Context.Provider, {\n    value: auth,\n    children: [children, \" \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 10\n  }, this);\n}\n\n_s(AuthProvider, \"KqAApnH+b8V7hJSKjHbpryicSg0=\");\n\n_c = AuthProvider;\nexport function RequireAuth(_ref4) {\n  _s2();\n\n  let {\n    children,\n    role\n  } = _ref4;\n  const {\n    authed\n  } = useAuth();\n  const {\n    accessToken,\n    userRole\n  } = authed;\n  const location = useLocation();\n  const navigate = useNavigate();\n  console.log(authed);\n  console.log(accessToken);\n  console.log(userRole);\n  console.log(role);\n\n  if (accessToken && userRole && userRole === role) {\n    return children;\n  } else {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 12\n    }, this);\n  }\n}\n\n_s2(RequireAuth, \"ls4KvmGTIStyzzPTxYz94vj3pws=\", false, function () {\n  return [useAuth, useLocation, useNavigate];\n});\n\n_c2 = RequireAuth;\nexport default function AuthConsumer() {\n  _s3();\n\n  return React.useContext(authContext);\n}\n\n_s3(AuthConsumer, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\n_c3 = AuthConsumer;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"RequireAuth\");\n$RefreshReg$(_c3, \"AuthConsumer\");","map":{"version":3,"names":["Navigate","useLocation","useNavigate","axios","LOGIN_URL","React","useState","useEffect","Context","createContext","useAuth","setData","accessToken","role","name","userId","localStorage","setItem","login","user","pwd","userRole","response","post","JSON","stringify","headers","withCredentials","auth","error","console","log","AuthProvider","children","setAuth","parse","getItem","temp","RequireAuth","authed","location","navigate","AuthConsumer","useContext","authContext"],"sources":["/Users/oscarlai/Desktop/NUS/Year 4/Semester 1/IFS4205/IFS4205-Group3-Crowdsensing-Med-App/frontend/src/context/AuthProvider.js"],"sourcesContent":["// import * as React from \"react\";\nimport { Navigate, useLocation } from \"react-router-dom\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { LOGIN_URL } from \"../api/constants\";\nimport { React, useState, useEffect } from \"react\";\n\n// const authContext = React.createContext();\n\nconst Context = React.createContext();\n\nfunction useAuth() {\n  const setData = ({ accessToken, role, name, userId }) => {\n    localStorage.setItem(\"accessToken\", accessToken);\n    localStorage.setItem(\"userRole\", role);\n    localStorage.setItem(\"name\", name);\n    localStorage.setItem(\"userId\", userId);\n  };\n\n  const login = async ({ user, pwd, userRole }) => {\n    try {\n      const response = await axios.post(\n        LOGIN_URL,\n        JSON.stringify({ user, pwd, userRole }),\n        {\n          headers: { \"Content-Type\": \"application/json\" },\n          withCredentials: true,\n        }\n      );\n      const accessToken = \"response?.data?.accessToken\";\n      const role = \"patient\";\n      const name = \"John\";\n      const userId = \"response?.data.userId\";\n\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId,\n      };\n\n      setData(auth);\n    } catch (error) {\n      const accessToken = \"response?.data?.accessToken\";\n      const role = \"patient\";\n      const name = \"John\";\n      const userId = \"response?.data.userId\";\n      console.log(\"here\");\n\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId,\n      };\n      setData(auth);\n      console.log(error);\n    }\n  };\n\n  // const checkRole = ({accessToken,userRole}) => {\n  //   if ()\n  // }\n\n  // const [authed, setAuthed] = React.useState({});\n\n  return {\n    // authed,\n    login,\n    // login() {\n    //   return new Promise((res) => {\n    //     setAuthed(true);\n    //     res();\n    //   });\n    // },\n    // logout() {\n    //   return new Promise((res) => {\n    //     setAuthed(false);\n    //     res();\n    //   });\n    // },\n  };\n}\n\nexport function AuthProvider({ children }) {\n  const [auth, setAuth] = useState({});\n\n  useEffect(() => {\n    const accessToken = JSON.parse(localStorage.getItem(\"accessToken\"));\n    const userRole = JSON.parse(localStorage.getItem(\"userRole\"));\n    const name = JSON.parse(localStorage.getItem(\"name\"));\n    const userId = JSON.parse(localStorage.getItem(\"userId\"));\n\n    if (accessToken && userRole && name && userId) {\n      const temp = {\n        accessToken: accessToken,\n        userRole: userRole,\n        name: name,\n        userId: userId,\n      };\n      setAuth(temp);\n    }\n  }, []);\n\n  return <Context.Provider value={auth}>{children} </Context.Provider>;\n}\n\nexport function RequireAuth({ children, role }) {\n  const { authed } = useAuth();\n  const { accessToken, userRole } = authed;\n  const location = useLocation();\n  const navigate = useNavigate();\n\n  console.log(authed);\n  console.log(accessToken);\n  console.log(userRole);\n  console.log(role);\n\n  if (accessToken && userRole && userRole === role) {\n    return children;\n  } else {\n    return <Navigate to=\"/login\" replace />;\n  }\n}\n\nexport default function AuthConsumer() {\n  return React.useContext(authContext);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}