{"ast":null,"code":"var _jsxFileName = \"/Users/oscarlai/Desktop/NUS/Year 4/Semester 1/IFS4205/IFS4205-Group3-Crowdsensing-Med-App/frontend/src/context/AuthProvider.js\",\n    _s = $RefreshSig$();\n\nimport { Navigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { LOGIN_URL } from \"../api/constants\";\nimport React, { useState, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Context = /*#__PURE__*/React.createContext();\nexport function useAuth() {\n  const setData = _ref => {\n    let {\n      accessToken,\n      userRole,\n      name,\n      userId\n    } = _ref;\n    localStorage.setItem(\"accessToken\", accessToken);\n    localStorage.setItem(\"userRole\", userRole);\n    localStorage.setItem(\"name\", name);\n    localStorage.setItem(\"userId\", userId);\n  };\n\n  const login = async _ref2 => {\n    let {\n      user,\n      pwd,\n      userRole\n    } = _ref2;\n    axios.post(LOGIN_URL, {\n      user: user,\n      pwd: pwd,\n      userRole: userRole\n    }).then(function (response) {\n      var _response$data, _response$data2, _response$data3, _response$data4;\n\n      // Getting response\n      const accessToken = response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.accessToken;\n      const role = response === null || response === void 0 ? void 0 : (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.userRole;\n      const name = response === null || response === void 0 ? void 0 : (_response$data3 = response.data) === null || _response$data3 === void 0 ? void 0 : _response$data3.name;\n      const userId = response === null || response === void 0 ? void 0 : (_response$data4 = response.data) === null || _response$data4 === void 0 ? void 0 : _response$data4.userId;\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId\n      };\n      setData(auth);\n    }).catch(function (err) {\n      var _err$response, _err$response2, _err$response3;\n\n      setSuccess(true); //comment out\n\n      console.log(\"here\");\n\n      if (!(err !== null && err !== void 0 && err.response)) {\n        setErrMsg(\"No Server Response\");\n      } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 400) {\n        setErrMsg(\"There was an error, please try again.\");\n      } else if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 403) {\n        setErrMsg(\"Action Forbidden\");\n      } else if (((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : _err$response3.status) === 500) {\n        setErrMsg(\"Action Forbidden\");\n      } else {\n        setErrMsg(\"Server encountered an error, please try again.\");\n      }\n    });\n\n    try {\n      var _response$data5, _response$data6, _response$data7, _response$data8;\n\n      const response = await axios.post(LOGIN_URL, JSON.stringify({\n        user,\n        pwd,\n        userRole\n      }), {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        withCredentials: true\n      }); // Getting response\n\n      const accessToken = response === null || response === void 0 ? void 0 : (_response$data5 = response.data) === null || _response$data5 === void 0 ? void 0 : _response$data5.accessToken;\n      const role = response === null || response === void 0 ? void 0 : (_response$data6 = response.data) === null || _response$data6 === void 0 ? void 0 : _response$data6.userRole;\n      const name = response === null || response === void 0 ? void 0 : (_response$data7 = response.data) === null || _response$data7 === void 0 ? void 0 : _response$data7.name;\n      const userId = response === null || response === void 0 ? void 0 : (_response$data8 = response.data) === null || _response$data8 === void 0 ? void 0 : _response$data8.userId;\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId\n      };\n      setData(auth);\n      const responseObject = {\n        statusCode: 200\n      };\n      return responseObject;\n    } catch (error) {\n      const accessToken = \"access_token\";\n      const role = \"patient\";\n      const name = \"Oscar\";\n      const userId = \"user_id\";\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId\n      };\n      var errorCode = 200;\n      setData(auth); // COMMENT OUT\n      //   var errorCode;\n      //   if (!error?.response) {\n      //     errorCode = 400;\n      //   } else if (error.response?.status === 400) {\n      //     errorCode = 400;\n      //   } else if (error.response?.status === 401) {\n      //     errorCode = 401;\n      //   } else {\n      //     errorCode = 500;\n      //   }\n\n      const errorObject = {\n        statusCode: errorCode\n      };\n      return errorObject;\n    }\n  };\n\n  const logout = async () => {\n    localStorage.removeItem(\"accessToken\");\n    localStorage.removeItem(\"userRole\");\n    localStorage.removeItem(\"name\");\n    localStorage.removeItem(\"userId\");\n  };\n\n  return {\n    login,\n    logout\n  };\n}\nexport function AuthProvider(_ref3) {\n  _s();\n\n  let {\n    children\n  } = _ref3;\n  const [auth, setAuth] = useState({});\n  useEffect(() => {\n    const accessToken = localStorage.getItem(\"accessToken\");\n    const userRole = localStorage.getItem(\"userRole\");\n    const name = localStorage.getItem(\"name\");\n    const userId = localStorage.getItem(\"userId\");\n\n    if (accessToken && userRole && name && userId) {\n      const temp = {\n        accessToken: accessToken,\n        userRole: userRole,\n        name: name,\n        userId: userId\n      };\n      setAuth(temp);\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(Context.Provider, {\n    value: auth,\n    children: [children, \" \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 150,\n    columnNumber: 10\n  }, this);\n}\n\n_s(AuthProvider, \"KqAApnH+b8V7hJSKjHbpryicSg0=\");\n\n_c = AuthProvider;\nexport function RequireAuth(_ref4) {\n  let {\n    children,\n    role\n  } = _ref4;\n  const accessToken = localStorage.getItem(\"accessToken\");\n  const userRole = localStorage.getItem(\"userRole\");\n\n  if (accessToken && userRole && userRole === role) {\n    return children;\n  } else {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 12\n    }, this);\n  }\n}\n_c2 = RequireAuth;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"RequireAuth\");","map":{"version":3,"names":["Navigate","axios","LOGIN_URL","React","useState","useEffect","Context","createContext","useAuth","setData","accessToken","userRole","name","userId","localStorage","setItem","login","user","pwd","post","then","response","data","role","auth","catch","err","setSuccess","console","log","setErrMsg","status","JSON","stringify","headers","withCredentials","responseObject","statusCode","error","errorCode","errorObject","logout","removeItem","AuthProvider","children","setAuth","getItem","temp","RequireAuth"],"sources":["/Users/oscarlai/Desktop/NUS/Year 4/Semester 1/IFS4205/IFS4205-Group3-Crowdsensing-Med-App/frontend/src/context/AuthProvider.js"],"sourcesContent":["import { Navigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { LOGIN_URL } from \"../api/constants\";\nimport React, { useState, useEffect } from \"react\";\n\nconst Context = React.createContext();\n\nexport function useAuth() {\n  const setData = ({ accessToken, userRole, name, userId }) => {\n    localStorage.setItem(\"accessToken\", accessToken);\n    localStorage.setItem(\"userRole\", userRole);\n    localStorage.setItem(\"name\", name);\n    localStorage.setItem(\"userId\", userId);\n  };\n\n  const login = async ({ user, pwd, userRole }) => {\n    axios\n      .post(LOGIN_URL, {\n        user: user,\n        pwd: pwd,\n        userRole: userRole,\n      })\n      .then(function (response) {\n        // Getting response\n        const accessToken = response?.data?.accessToken;\n        const role = response?.data?.userRole;\n        const name = response?.data?.name;\n        const userId = response?.data?.userId;\n\n        const auth = {\n          accessToken: accessToken,\n          userRole: role,\n          name: name,\n          userId: userId,\n        };\n        setData(auth);\n      })\n      .catch(function (err) {\n        setSuccess(true); //comment out\n        console.log(\"here\");\n        if (!err?.response) {\n          setErrMsg(\"No Server Response\");\n        } else if (err.response?.status === 400) {\n          setErrMsg(\"There was an error, please try again.\");\n        } else if (err.response?.status === 403) {\n          setErrMsg(\"Action Forbidden\");\n        } else if (err.response?.status === 500) {\n          setErrMsg(\"Action Forbidden\");\n        } else {\n          setErrMsg(\"Server encountered an error, please try again.\");\n        }\n      });\n\n    try {\n      const response = await axios.post(\n        LOGIN_URL,\n        JSON.stringify({ user, pwd, userRole }),\n        {\n          headers: { \"Content-Type\": \"application/json\" },\n          withCredentials: true,\n        }\n      );\n\n      // Getting response\n      const accessToken = response?.data?.accessToken;\n      const role = response?.data?.userRole;\n      const name = response?.data?.name;\n      const userId = response?.data?.userId;\n\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId,\n      };\n      setData(auth);\n\n      const responseObject = {\n        statusCode: 200,\n      };\n      return responseObject;\n    } catch (error) {\n      const accessToken = \"access_token\";\n      const role = \"patient\";\n      const name = \"Oscar\";\n      const userId = \"user_id\";\n\n      const auth = {\n        accessToken: accessToken,\n        userRole: role,\n        name: name,\n        userId: userId,\n      };\n      var errorCode = 200;\n      setData(auth);\n\n      // COMMENT OUT\n      //   var errorCode;\n\n      //   if (!error?.response) {\n      //     errorCode = 400;\n      //   } else if (error.response?.status === 400) {\n      //     errorCode = 400;\n      //   } else if (error.response?.status === 401) {\n      //     errorCode = 401;\n      //   } else {\n      //     errorCode = 500;\n      //   }\n\n      const errorObject = {\n        statusCode: errorCode,\n      };\n      return errorObject;\n    }\n  };\n\n  const logout = async () => {\n    localStorage.removeItem(\"accessToken\");\n    localStorage.removeItem(\"userRole\");\n    localStorage.removeItem(\"name\");\n    localStorage.removeItem(\"userId\");\n  };\n\n  return {\n    login,\n    logout,\n  };\n}\n\nexport function AuthProvider({ children }) {\n  const [auth, setAuth] = useState({});\n\n  useEffect(() => {\n    const accessToken = localStorage.getItem(\"accessToken\");\n    const userRole = localStorage.getItem(\"userRole\");\n    const name = localStorage.getItem(\"name\");\n    const userId = localStorage.getItem(\"userId\");\n\n    if (accessToken && userRole && name && userId) {\n      const temp = {\n        accessToken: accessToken,\n        userRole: userRole,\n        name: name,\n        userId: userId,\n      };\n      setAuth(temp);\n    }\n  }, []);\n\n  return <Context.Provider value={auth}>{children} </Context.Provider>;\n}\n\nexport function RequireAuth({ children, role }) {\n  const accessToken = localStorage.getItem(\"accessToken\");\n  const userRole = localStorage.getItem(\"userRole\");\n\n  if (accessToken && userRole && userRole === role) {\n    return children;\n  } else {\n    return <Navigate to=\"/login\" replace />;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}